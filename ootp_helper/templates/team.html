<!doctype html>
<link rel= "stylesheet" type= "text/css" href= "../static/styles/style.css">
<script src="../static/sorttable.js"></script>
<script src="../static/utils.js"></script>


<style>
.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  padding: 12px 16px;
  z-index: 1;
}

.dropdown:hover .dropdown-content {
  display: block;
}
</style>

<title>Team Info</title>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css"/>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>

<h1> <a href = "../"><img src="../static/bender.png", width="5%"> OOTP Robit</a></h1>
<h2> {% if phrase %} {{phrase}} {% else %} This would say something witty, but Hugh is dumb {% endif %}</h2>

<div class='row'>
    <div class = 'column'>
        <h3> Team search </h3>
        <form method="POST">
            <input name="team">
            <input type="submit">
        </form>
    </div>
    <div class = 'column'  valign="center">
        <input type = 'button' value = 'Player Comparison' onclick='window.location.href="/compare"'>
    </div>
    <div class = 'column'>
        <h3> Player search </h3>
        <form method="POST">
            <input name="player">
            <input type="submit">
        </form>
    </div>
</div>
<hr></hr>

{% if name %}
<h1> {{name}} </h1>
{% else %}
{% endif %}

{% if team_logo %}
 <img src='{{team_logo}}', height='150px', align="middle"> 
{% else %}
{% endif %}

<br>

{% if header_rec %}
<h2> {{header_rec | safe}} </h2>
{% else %}
{% endif %}

{% if header_fin %}
<h2> {{header_fin}} </h2>
{% else %}
{% endif %}

<br>

{% if header_ded %}
<h2> {{header_ded | safe}} </h2>
{% else %}
{% endif %}

<hr></hr>

{% if batting_table and pitching_table %}
    <div class='row'>
    <div class='col-md-auto' style="padding-right:20px; border-right: 1px solid #ccc;">
      {{batting_table|safe}}
    </div>
    <div class='col-md-auto'>
      {{pitching_table|safe}}
    </div>
    </div>
{% endif %}

<!-- tables to be filled in w/ js later -->
<hr/>

<h2 style="margin-bottom: 20px"> Major League Roster </h2>
<table id="ml-roster" class="display" style="width:100%"></table>

<hr/>

<h2 style="margin-bottom: 20px"> Farm System</h2>
<table id="farm-system" class="display" style="width:100%"></table>

<hr/>

<h2 style="margin-bottom: 20px"> Other Scout Ratings </h2>
    <table id="other-scout-ratings" class="display" style="width:100%"></table>

<script>
    // columns that will always be stylized as ratings
    const ratingColumns = ['POT'];  //, 'CON P', 'GAP P', 'POW P', 'EYE P', 'K P', 'STU P', 'MOV P', 'CTL P'];

    // team roster
    let majorsColNames = {{ majors_columns|safe }};
    let majorsDataSet = {{ majors_data|safe }};

    let majorsColumns = majorsColNames.map(function(item) {return {title: item}});

    let majorsColDefs = [
        {
            targets: ratingColumns.map(function(e){return(majorsColNames.indexOf(e))}),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(70, 55, 40, 25, cellData, true));
            }
        },
        {
            targets: majorsColNames.indexOf('mwar_mean'),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(6.5, 4.5, 3.8, 3, cellData, true));
            }
        },
        {
            targets: majorsColNames.indexOf('Age'),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(0, 21, 30, 35, cellData, false));
            }
        },
    ];

    $(document).ready(function() {
        const majorsTable = $('#ml-roster').DataTable( {
            data: majorsDataSet,
            columns: majorsColumns,
            columnDefs: majorsColDefs,
            pageLength: 10,
            dom: '<l<t>p>',
            order: [[majorsColNames.indexOf('old grade'), 'desc']],
        } );

        // Setup - add a text input to each footer cell
        $('#ml-roster thead tr').clone(true).appendTo('#ml-roster thead');
        $('#ml-roster thead tr:eq(1) th').each(function (i) {
            var title = $(this).text();
            $(this).html('<input type="text" placeholder="" />');

            $('input', this).on('keyup change', function () {
                if (majorsTable.column(i).search() !== this.value) {
                    majorsTable.column(i).search(this.value).draw();
                }
            });
        });
    });


    // team prospect table
    let prospectColNames = {{ prospects_columns|safe }};
    let prospectDataSet = {{ prospects_data|safe }};

    let prospectColumns = prospectColNames.map(function(item) {return {title: item}});

    let prospectsColDefs = [
        {
            targets: ratingColumns.map(function(e){return(prospectColNames.indexOf(e))}),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(70, 55, 40, 25, cellData, true));
            }
        },
        {
            targets: prospectColNames.indexOf('mwar_mean'),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(6.5, 4.5, 3.8, 3, cellData, true));
            }
        },
        {
            targets: prospectColNames.indexOf('Age'),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(0, 21, 30, 35, cellData, false));
            }
        },
    ];

    $(document).ready(function() {
        let minorsTable = $('#farm-system').DataTable( {
            data: prospectDataSet,
            columns: prospectColumns,
            columnDefs: prospectsColDefs,
            pageLength: 10,
            dom: '<l<t>p>',
            order: [[prospectColNames.indexOf('old grade'), 'desc']],
        } );

        $('#farm-system thead tr').clone(true).appendTo('#farm-system thead');
        $('#farm-system thead tr:eq(1) th').each(function (i) {
            let minorsTitle = $(this).text();
            $(this).html('<input type="text" placeholder="" />');

            $('input', this).on('keyup change', function () {
                if (minorsTable.column(i).search() !== this.value) {
                    minorsTable.column(i).search(this.value).draw();
                }
            });
        });
    } );

    // other scout table
    let otherScoutColNames = {{ other_scouts_columns|safe }};
    let otherScoutDataSet = {{ other_scouts_data|safe }};
    let otherScoutIndexes = {{ other_scout_indexes|safe }};

    let otherScoutColumns = otherScoutColNames.map(function(item) {return {title: item}});
    let otherScoutColDefs = [{
            targets: otherScoutIndexes,
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(70, 55, 40, 25, cellData, true));
            }
        },
        {
            targets: otherScoutColNames.indexOf('Age'),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(0, 21, 30, 35, cellData, false));
            }
        },
        {
            targets: otherScoutColNames.indexOf('mwar_mean'),
            createdCell: function (td, cellData, rowData, row, col) {
                $(td).css('background-color', ratingColorMap(6.5, 4.5, 3.8, 3, cellData, true));
            }
        }];

    $(document).ready(function() {
        let scoutRatings = $('#other-scout-ratings').DataTable( {
            data: otherScoutDataSet,
            columns: otherScoutColumns,
            columnDefs: otherScoutColDefs,
            pageLength: 10,
            dom: '<l<t>p>',
            order: [[otherScoutColNames.indexOf('old grade'), 'desc']],
        } );

        let filterOption = 'EQ';

        let drawHeader = () => {
            $('#other-scout-ratings thead tr').clone(true).appendTo('#other-scout-ratings thead');
            $('#other-scout-ratings thead tr:eq(1) th').each(function (i) {
                if (i === 0) {
                    //$(this).html('' +
                    //    '<div class="dropdown">\n' +
                    //    '  <button class="dropbtn">Filter Options</button>\n' +
                    //    '  <div class="dropdown-content">\n' +
                    //    '    <li id="other-dropdown-eq"> = </li>\n' +
                    //    '    <li id="other-dropdown-gte"> > </li>\n' +
                    //    '    <li id="other-dropdown-lte"> < </li>\n' +
                    //    '  </div>\n' +
                    //    '</div>'
                    //);

                    return;
                }

                let otherScoutTitle = $(this).text();
                $(this).html('<input type="text" />');

                $('input', this).on('keyup change', function () {
                    const searchValue = this.value;

                    if (filterOption === 'EQ') {
                        if (scoutRatings.column(i).search() !== this.value) {
                            scoutRatings.column(i).search(this.value).draw();
                        }
                    }

                    if (filterOption === 'GTE') {
                        scoutRatings.column(i).filter(function (column, idx) {
                            return parseFloat(column) >= parseFloat(searchValue)
                        }).draw();
                    }

                    if (filterOption === 'LTE') {
                        if (scoutRatings.column(i).search() <= this.value) {
                            scoutRatings.column(i).search(this.value).draw();
                        }
                    }
                });
            });
        };

        drawHeader();

    } );
</script>
